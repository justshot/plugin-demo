!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("redux"),require("axios"),require("react-redux")):"function"==typeof define&&define.amd?define("wfo-identity-client-flex",["redux","axios","react-redux"],t):"object"==typeof exports?exports["wfo-identity-client-flex"]=t(require("redux"),require("axios"),require("react-redux")):e["wfo-identity-client-flex"]=t(e.redux,e.axios,e["react-redux"])}(window,function(e,t,n){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=14)}([function(e,t,r){e.exports=r(11)},function(e,t,n){window,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=8)}([function(e,t,r){e.exports=r(6)},function(e,t){function r(e,t,r,n,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}e.exports=function(e){return function(){var t=this,n=arguments;return new Promise(function(o,i){var a=e.apply(t,n);function s(e){r(a,o,i,s,u,"next",e)}function u(e){r(a,o,i,s,u,"throw",e)}s(void 0)})}}},function(e,t){e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){e.exports=r(1)},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n="ytica-js-logger:enabled",o={};function i(e,t){if(this.isBrowser&&!this.isEnabled)return!1;var r=this.options.formatter(Array.prototype.slice.call(t),this);this.options.logHandler&&this.enabledFor(e)&&this.options.logHandler(r,e),this.options.afterLog.call(this,r,e)}function a(e,t){if("undefined"!=typeof console){var r=console.log;t===o.ERROR&&console.error?r=console.error:t===o.WARN&&console.warn?r=console.warn:t===o.INFO&&console.info?r=console.info:t===o.DEBUG&&console.debug&&(r=console.debug),function(e,t){Function.prototype.apply.call(e,console,t)}(r,e)}}function s(e,t){return e.unshift("[".concat(t.options.name,"]")),e}o.DEBUG={value:0,name:"DEBUG"},o.INFO={value:1,name:"INFO"},o.WARN={value:2,name:"WARN"},o.ERROR={value:3,name:"ERROR"};var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r,i={level:o.INFO,logHandler:a,afterLog:function(){},suppress:[],formatter:s};this.options=Object.assign({},i,t),this.isBrowser&&(r=!0,localStorage.getItem(n)||localStorage.setItem(n,r))}var t,u,c;return t=e,c=[{key:"DEBUG",get:function(){return o.DEBUG}},{key:"INFO",get:function(){return o.INFO}},{key:"WARN",get:function(){return o.WARN}},{key:"ERROR",get:function(){return o.ERROR}}],(u=[{key:"enabledFor",value:function(e){var t=this.localStorageDefaultLevel||this.options.level,r=e.value>=t.value,n=this.options.suppress.includes(e);return r&&!n}},{key:"debug",value:function(){i.call(this,o.DEBUG,arguments)}},{key:"info",value:function(){i.call(this,o.INFO,arguments)}},{key:"log",value:function(){i.call(this,o.INFO,arguments)}},{key:"warn",value:function(){i.call(this,o.WARN,arguments)}},{key:"error",value:function(){i.call(this,o.ERROR,arguments)}},{key:"isEnabled",get:function(){return JSON.parse(localStorage.getItem(n))}},{key:"localStorageDefaultLevel",get:function(){var e=localStorage.getItem("ytica-js-logger:logLevel");return o[e]}},{key:"isBrowser",get:function(){return"undefined"!=typeof window}}])&&r(t.prototype,u),c&&r(t,c),e}();e.exports=u}])},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}},function(e,t){e.exports=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},function(e,t,r){var n=function(){return this||"object"==typeof self&&self}()||Function("return this")(),o=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,i=o&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,e.exports=r(7),o)n.regeneratorRuntime=i;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";var r,n=Object.prototype,o=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag",c="object"==typeof e,l=t.regeneratorRuntime;if(l)c&&(e.exports=l);else{(l=t.regeneratorRuntime=c?e.exports:{}).wrap=w;var f="suspendedStart",h="suspendedYield",d="executing",p="completed",g={},y={};y[a]=function(){return this};var v=Object.getPrototypeOf,m=v&&v(v(E([])));m&&m!==n&&o.call(m,a)&&(y=m);var k=b.prototype=R.prototype=Object.create(y);S.prototype=k.constructor=b,b.constructor=S,b[u]=S.displayName="GeneratorFunction",l.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===S||"GeneratorFunction"===(t.displayName||t.name))},l.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u in e||(e[u]="GeneratorFunction")),e.prototype=Object.create(k),e},l.awrap=function(e){return{__await:e}},x(P.prototype),P.prototype[s]=function(){return this},l.AsyncIterator=P,l.async=function(e,t,r,n){var o=new P(w(e,t,r,n));return l.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},x(k),k[u]="Generator",k[a]=function(){return this},k.toString=function(){return"[object Generator]"},l.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},l.values=E,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=r)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,o){return s.type="throw",s.arg=e,t.next=n,o&&(t.method="next",t.arg=r),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var u=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=r),g}}}function w(e,t,r,n){var o=t&&t.prototype instanceof R?t:R,i=Object.create(o.prototype),a=new I(n||[]);return i._invoke=function(e,t,r){var n=f;return function(o,i){if(n===d)throw new Error("Generator is already running");if(n===p){if("throw"===o)throw i;return j()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=L(a,r);if(s){if(s===g)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===f)throw n=p,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=d;var u=_(e,t,r);if("normal"===u.type){if(n=r.done?p:h,u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=p,r.method="throw",r.arg=u.arg)}}}(e,r,a),i}function _(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function R(){}function S(){}function b(){}function x(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function P(e){var t;this._invoke=function(r,n){function i(){return new Promise(function(t,i){!function t(r,n,i,a){var s=_(e[r],e,n);if("throw"!==s.type){var u=s.arg,c=u.value;return c&&"object"==typeof c&&o.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,i,a)},function(e){t("throw",e,i,a)}):Promise.resolve(c).then(function(e){u.value=e,i(u)},function(e){return t("throw",e,i,a)})}a(s.arg)}(r,n,t,i)})}return t=t?t.then(i,i):i()}}function L(e,t){var n=e.iterator[t.method];if(n===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=r,L(e,t),"throw"===t.method))return g;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var o=_(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,g;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=r),t.delegate=null,g):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,g)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function E(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(o.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=r,t.done=!0,t};return i.next=i}}return{next:j}}function j(){return{value:r,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t,n){"use strict";n.r(t);var o=n(0),i=n.n(o),a=n(1),s=n.n(a),u=n(3),c=n.n(u),l=n(4),f=n.n(l),h=n(5),d=n.n(h),p=n(2),g=n.n(p),y=new g.a({name:"Identity",level:g.a.ERROR}),v={url:"/api",loginUrl:"/signin",logoutUrl:"/signout",refreshUrl:"/renew-token",userinfoUrl:"/userinfo",serviceSsoUrl:"/sso-url",authSsoUrl:"/sso-auth",oauthSsoUrl:"/sso-oauth",switchAccountUrl:"/switch-account",ssoLoginUrl:"https://apigw.ytica.com/provisioning/token-generator",accessToken:"authorization_token",refreshToken:"refresh_token",refreshBeforeExpireSec:3e4,unauthorizedRedirect:null,redirect:null,scope:"",accessTokenLocalStorageKey:"ytica-identity-client-vue:accessToken",refreshTokenLockLocalStorageKey:"ytica-identity-client-vue:refreshTokenLock",refreshTokenLockTimeout:3e4,refreshTokenLocalStorageKey:"ytica-identity-client-vue:refreshToken",clockSkewStorageKey:"ytica-identity-client-vue:clockSkew",baseUrl:""},m={expires:null,user:null,jwtPayload:null,notBefore:null,issuedAt:null,loading:!1,checking:!1,isLoggedIn:!1,uniqueId:null,idthrdOrder:null,onLoggedInChanged:null,refreshTimeoutId:null,runningRefreshPromise:null,runningRefreshPromiseResolve:null,refreshToken:null,accessToken:null,clockSkew:null},k=function(){function e(t){var r=this;c()(this,e),d()(this,"_setAccessToken",function(e){r.accessToken=e,y.log("Set new accessToken"),r._parseJWT(r.accessToken,!0),r._updateLoggedInStatus()}),this.options=Object.assign(v,t),this.axios=t.axios,this.axios||y.error("Axios was not passed to identity client."),this.onPropertyUpdated=t.onPropertyUpdated}return f()(e,[{key:"_created",value:function(){this._defineData(m),this._defineReactiveProperties(),this._defineLocalStorageProperties(),this._addLocalStorageEventListener(),this._initializeInterceptors(),this.accessToken&&this._parseJWT(this.accessToken),this._clearOldIdthrd(),this._setUniqueId(),y.log("ytica-identity-client-vue created [".concat(this.uniqueId,"]")),this._updateIdthrdOrder(),window.onbeforeunload=this._clearStorage.bind(this)}},{key:"_createReactiveProperty",value:function(e){return{set:function(t){if(this[e]=t,"function"==typeof this.onPropertyUpdated){var r=e.replace("_","");this.onPropertyUpdated({name:r,value:t})}},get:function(){return this[e]}}}},{key:"_defineReactiveProperties",value:function(){Object.defineProperties(this,{expires:this._createReactiveProperty("_expires"),user:this._createReactiveProperty("_user"),jwtPayload:this._createReactiveProperty("_jwtPayload"),notBefore:this._createReactiveProperty("_notBefore"),issuedAt:this._createReactiveProperty("_issuedAt"),loading:this._createReactiveProperty("_loading"),checking:this._createReactiveProperty("_checking"),isLoggedIn:this._createReactiveProperty("_isLoggedIn"),uniqueId:this._createReactiveProperty("_uniqueId"),idthrdOrder:this._createReactiveProperty("_idthrdOrder"),refreshTimeoutId:this._createReactiveProperty("_refreshTimeoutId"),runningRefreshPromise:this._createReactiveProperty("_runningRefreshPromise"),runningRefreshPromiseResolve:this._createReactiveProperty("_runningRefreshPromiseResolve")})}},{key:"_defineData",value:function(e){var t=this;Object.keys(e).forEach(function(r){t[r]=e[r]})}},{key:"_defineLocalStorageProperties",value:function(){"function"==typeof this.onPropertyUpdated&&this.onPropertyUpdated({name:"refreshToken",value:localStorage.getItem(this.options.refreshTokenLocalStorageKey)}),"function"==typeof this.onPropertyUpdated&&this.onPropertyUpdated({name:"accessToken",value:localStorage.getItem(this.options.accessTokenLocalStorageKey)}),"function"==typeof this.onPropertyUpdated&&this.onPropertyUpdated({name:"clockSkew",value:parseInt(localStorage.getItem(this.options.clockSkewStorageKey)||0)});var e=this;Object.defineProperty(e,"refreshToken",{set:function(t){y.log("refreshToken set"),t?(localStorage.setItem(e.options.refreshTokenLocalStorageKey,t),"function"==typeof e.onPropertyUpdated&&e.onPropertyUpdated({name:"refreshToken",value:t})):(localStorage.removeItem(e.options.refreshTokenLocalStorageKey),"function"==typeof e.onPropertyUpdated&&e.onPropertyUpdated({name:"refreshToken",value:null}))},get:function(){return localStorage.getItem(e.options.refreshTokenLocalStorageKey)}}),Object.defineProperty(e,"accessToken",{set:function(t){y.log("accessToken set"),t?(localStorage.setItem(e.options.accessTokenLocalStorageKey,t),"function"==typeof e.onPropertyUpdated&&e.onPropertyUpdated({name:"accessToken",value:t})):(localStorage.removeItem(e.options.accessTokenLocalStorageKey),"function"==typeof e.onPropertyUpdated&&e.onPropertyUpdated({name:"accessToken",value:null}))},get:function(){return localStorage.getItem(e.options.accessTokenLocalStorageKey)}}),Object.defineProperty(e,"clockSkew",{set:function(t){y.log("clockSkew set:",t),t?(localStorage.setItem(e.options.clockSkewStorageKey,t),"function"==typeof e.onPropertyUpdated&&e.onPropertyUpdated({name:"clockSkew",value:t})):(localStorage.removeItem(e.options.clockSkewStorageKey),"function"==typeof e.onPropertyUpdated&&e.onPropertyUpdated({name:"clockSkew",value:null}))},get:function(){return parseInt(localStorage.getItem(e.options.clockSkewStorageKey)||0)}})}},{key:"_clearOldIdthrd",value:function(){Object.keys(localStorage).filter(function(e){return e.startsWith("idthrd:")}).forEach(function(e){localStorage.removeItem(e)})}},{key:"_setUniqueId",value:function(){this.uniqueId=Date.now()+":"+(1e9*Math.random()|0),this._updateIdthrdOrder()}},{key:"_updateIdthrdOrder",value:function(){var e=null,t=!1,r=Object.keys(localStorage).filter(function(e){return e.startsWith("idthrd:")});r.sort(),y.log("idthrdKeysLS =",r);for(var n=0;n<r.length;n++)if(r[n]===this.idthrd){e=n,y.log("updateIdthrdOrder break order =",e);break}if(null===e){t=!0,r.push(this.idthrd),r.sort(),y.log("idthrdKeysLS extended =",r);for(var o=0;o<r.length;o++)if(r[o]===this.idthrd){e=o,y.log("updateIdthrdOrder break order =",e);break}}(t||null===this.idthrdOrder||this.idthrdOrder!==e)&&(this.idthrdOrder=e,y.log("updateIdthrdOrder",this.idthrd,this.idthrdOrder),localStorage.setItem(this.idthrd,this.idthrdOrder))}},{key:"_clearStorage",value:function(){y.log("ytica-identity-client-vue onbeforeunload [".concat(this.idthrd,"]")),localStorage.getItem(this.options.refreshTokenLockLocalStorageKey)===this.uniqueId&&localStorage.removeItem(this.options.refreshTokenLockLocalStorageKey),localStorage.removeItem(this.idthrd)}},{key:"_updateLoggedInStatus",value:function(){var e=this.isLoggedIn;this.isLoggedIn=this._isTokenValid()&&!!this.user,y.log("updateLoggedInStatus ",e,"=>",this.isLoggedIn),y.log(this),this.onLoggedInChanged&&this.onLoggedInChanged(e,this.isLoggedIn)}},{key:"_isTokenValid",value:function(){return y.log("isTokenValid. clockSkew",this.clockSkew,"\nisTokenValid. expires",new Date(1e3*this.expires).toJSON(),"\nisTokenValid. expires + clockSkew",new Date(1e3*(this.expires+this.clockSkew)).toJSON(),"\nisTokenValid. Date.now() ",new Date(Date.now()).toJSON(),"\nisTokenValid. (this.expires * 1000) - Date.now() ",1e3*this.expires-Date.now(),"\nisTokenValid. ((this.expires + this.clockSkew - 1)* 1000) - Date.now() ",1e3*(this.expires+this.clockSkew-1)-Date.now()),!!this.accessToken&&1e3*(this.expires+this.clockSkew-1)-Date.now()>0}},{key:"_addLocalStorageEventListener",value:function(){var e=this;window.addEventListener("storage",function(t){if(y.log("LocalStorage event e.key:",t.key,", newValue!==e.oldValue: ",t.newValue!==t.oldValue,", ",t.oldValue,"->",t.newValue),t.key===e.options.refreshTokenLocalStorageKey||t.key===e.options.accessTokenLocalStorageKey)t.key===e.options.refreshTokenLocalStorageKey&&t.newValue!==t.oldValue&&(y.log("refreshToken changed in LocalStorage: ",window.localStorage.getItem(e.options.refreshTokenLocalStorageKey)),e._setRefreshToken(t.newValue)),t.key===e.options.accessTokenLocalStorageKey&&t.newValue!==t.oldValue&&(y.log("accessToken changed in LocalStorage: ",t.oldValue,"->",t.newValue),t.newValue?e._setAccessToken(t.newValue):(e._clearRunningRefreshPromise(),e.logout()));else if(t.key===e.options.refreshTokenLockLocalStorageKey){if(!t.newValue){var r=e._getRandomTimeout();setTimeout(function(){y.log("UNLOCK other",r),e._resolveRunningRefreshPromise("unlock other")},r)}}else t.key.startsWith("idthrd:")&&e._updateIdthrdOrder()})}},{key:"_initializeInterceptors",value:function(){var e,t=this,r=this;this.axios.interceptors.request.use((e=s()(i.a.mark(function e(n){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(y.log("Request interceptor ".concat(n.url)),!t.runningRefreshPromiseResolve||n.url!==r._uri("refresh")){e.next=4;break}return y.log("Request interceptor: runningRefreshPromiseResolve not null, cancelling request ".concat(n.url)),e.abrupt("return",Promise.reject("Parallel request to ".concat(n.url," cancelled")));case 4:if(!0===n.noAuth||n.url===r._uri("login")||n.url===r._uri("authSso")||n.url===r._uri("oauthSso")||n.url===r.options.ssoLoginUrl){e.next=16;break}if(n.url===r._uri("refresh")||n.url===r._uri("serviceSso")&&n.data&&"talkdesk"===n.data.target_sso){e.next=10;break}return y.log("Request interceptor before self.authenticate"),e.next=9,r.authenticate();case 9:y.log("Request interceptor after self.authenticate");case 10:if(n.url===r._uri("refresh")||n.url===r._uri("serviceSso")||n.url===r._uri("logout")){e.next=14;break}return y.log("Request interceptor self.refresh()"),e.next=14,r._refresh();case 14:n.headers.common.Authorization="Bearer "+r.accessToken,y.log("Authorization header set bearer");case 16:return e.abrupt("return",n);case 17:case"end":return e.stop()}},e,this)})),function(t){return e.apply(this,arguments)}),function(e){return Promise.reject(e)}),this.axios.interceptors.response.use(function(e){return e},function(e){return y.log(e),y.log("error.response:",e.response),r._checkIfLogoutNeeded(e.response),y.log("Response error, reject(error)"),Promise.reject(e)})}},{key:"_checkIfLogoutNeeded",value:function(e){try{var t=[this._uri("refresh"),this._uri("authSso"),this._uri("oauthSso"),this._uri("switchAccount")];y.log("allAuthUrls",t),y.log("response",e),e&&e.status&&(401===e.status||401===e.status)&&e.config&&t.includes(e.config.url)?(y.log("error.response.config.url",e.config.url),y.log("this.logout() is needed!"),this.logout()):y.log("logout() is not needed.")}catch(e){y.error(e)}}},{key:"_uri",value:function(e){return this.options.url+this.options[e+"Url"]}},{key:"_refresh",value:function(e){var t=this;return y.log("self.refresh()"),this._runSyncedAuthenticationRequest(function(){if(e)return y.info("RUN REFRESH. force"),t._refreshRequest();var r=t._getMillisecondsLeftToExpire();return r<=t.options.refreshBeforeExpireSec?t._isTokenValid()?(y.info("RUN REFRESH. tokenValid, mlsLeft:",r),t._refreshRequest(),new Promise(function(e){var r=t._getRandomTimeout();setTimeout(function(){y.log("Run parallel refresh",r),e("Run parallel refresh")},r)})):(y.info("RUN REFRESH. tokenInvalid, mlsLeft:",r),t._refreshRequest()):(y.log("refresh token not needed"),Promise.resolve("Refresh token not needed").then(function(e){return y.log("refresh token not needed"),t._clearRunningRefreshPromise(),y.log("Clear local lock"),t._removeLock(),Promise.resolve(e)}))})}},{key:"_getRandomTimeout",value:function(){return 20*(this.idthrdOrder||0)+10}},{key:"_refreshRequest",value:function(){var e=this;if(y.log("this._refreshRequest()"),!this.refreshToken)return Promise.reject("Refresh token is empty");var t={};t[this.options.refreshToken]=this.refreshToken;var r={headers:{uniqueId:this.uniqueId}};return this._attachRequestQuarterback(this.axios.post(this._uri("refresh"),t,r)).then(function(t){return y.log("then this._refresh  tokenValid after Refresh"),e._clearRunningRefreshPromise(),e._removeLock(),Promise.resolve(t)}).catch(function(t){return y.log("catch this._refresh tokenValid after Refresh"),e._clearRunningRefreshPromise(),e._removeLock(),Promise.reject(t)})}},{key:"_attachRequestQuarterback",value:function(e,t){var r=this;return t=t||{},this.loading=!0,e.then(function(e){return r._receivethMightyToken(e.data),r.loading=!1,Promise.resolve(e)}).catch(function(e){return r.loading=!1,y.log("error. loading false"),Promise.reject(e)})}},{key:"_checkClockSkew",value:function(e){y.log("Check Clock Skew"),this.clockSkew=Math.floor(Date.now()/1e3-this.jwtPayload.iat),y.log("Detected Clock Skew: ".concat(this.clockSkew," sec"))}},{key:"_parseJWT",value:function(e,t){var r=function(e){var t=e.split(".")[1].replace("-","+").replace("_","/");return JSON.parse(window.atob(t))}(e);this.jwtPayload=Object.assign({},r),this.user&&this.user.sub&&this.user.sub===r.sub?(y.log("user set(update): ",this.user," ->",r),this.user=Object.assign({},this.user,r)):(y.log("user set(clear):",this.user," ->",r),this.user=Object.assign({},r)),t&&this._checkClockSkew(r),this.issuedAt=this.jwtPayload.iat,this.notBefore=this.jwtPayload.nbf,this.expires=this.jwtPayload.exp,this.issuedAt&&(this.issuedAtDate=new Date(1e3*this.issuedAt),y.log("Parse new accessToken issuedAtDate: "+this.issuedAtDate.toJSON())),this.expiresDate=new Date(1e3*this.expires),y.log("Parse new accessToken expiresDate:",this.expiresDate.toJSON())}},{key:"_setRefreshToken",value:function(e){this.refreshToken=e,y.log("Set new refreshToken")}},{key:"_receivethMightyToken",value:function(e){var t,r,n=e[this.options.accessToken],o=e[this.options.refreshToken];if(void 0===n&&void 0===o)return r={code:-1,http:null},void 0!==(t="No token/refresh-token received").status?(r.code=t.status,r.error=t.statusText,r.data=t.data?t.data.errors:null,r.http=t,r.message=function(e){return"Connection Issue"===e.error?"Could not connect":"Bad Request"===e.error?"Invalid data":"Token Expired"===e.error?"Token Expired":500===e.code?"Server Error":404===e.code?"Not Found":403===e.code?"Forbidden":401===e.code?"Unauthorized":"Unknown error"}(r)):r.message=r.error=t,y.error("[VueIdentity Error]",r),Promise.reject(r);void 0!==o&&this._setRefreshToken(o),void 0!==n&&this._setAccessToken(n)}},{key:"_getMillisecondsLeftToExpire",value:function(){var e=1e3*(this.expires+this.clockSkew-1)-Date.now();return y.info("attemptRefresh mlsLeft=",e,", options['refreshBeforeExpireSec']=",this.options.refreshBeforeExpireSec),e}},{key:"_resolveRunningRefreshPromise",value:function(e){y.log("resolveRunningRefreshPromise:",e),this._clearRunningTimeout(),this.runningRefreshPromiseResolve&&(y.log("resolve waiting promise"),this._runningRefreshPromiseResolve(e),this.runningRefreshPromiseResolve=null)}},{key:"_runSyncedAuthenticationRequest",value:function(e){var t=this;return this.runningRefreshPromise?y.log("this.runningRefreshPromise is not empty"):(y.log("!this.runningRefreshPromise"),this._setLock()?(y.log("Is not locked. Run promise runSyncedAuthenticationRequest"),this.runningRefreshPromise=e().then(function(e){return y.log("runningRefreshPromise OK",e),Promise.resolve(e)}).catch(function(e){return y.log("runningRefreshPromise Error",e),Promise.reject(e)})):(y.log("IS LOCKED. other refresh() running"),this.runningRefreshPromise=new Promise(function(e){y.log("SET TIMEOUT for already running runningRefreshPromise"),t._resolveRunningRefreshPromise("clear before start timeout"),t.runningRefreshPromiseResolve=e;var r=t.options.refreshTokenLockTimeout+t._getRandomTimeout();t.refreshTimeoutId=setTimeout(function(){y.log("TIMEOUT refreshTokenLockHandle",r),t._clearRunningRefreshPromise(),t._removeLock(!0),t._resolveRunningRefreshPromise("after timeout")},r)}).then(function(r){return y.log("this.runningRefreshPromise RESOLVED",r),t._clearRunningRefreshPromise(),new Promise(function(r,n){var o=t._getRandomTimeout();setTimeout(function(){y.log("runSyncedAuthenticationRequest, after runningRefreshPromise resolve, then",o),t._runSyncedAuthenticationRequest(e).then(function(e){y.log("runSyncedAuthenticationRequest, after runningRefreshPromise resolve, promise then"),r(e)}).catch(function(e){y.log("runSyncedAuthenticationRequest, after runningRefreshPromise resolve, promise catch"),n(e)})},o)})}).catch(function(e){return Promise.reject(e)}))),y.log("return this.runningRefreshPromise"),this.runningRefreshPromise}},{key:"_setLock",value:function(){return localStorage.getItem(this.options.refreshTokenLockLocalStorageKey)?(y.log("SET LOCK false uniqueId: ".concat(this.uniqueId)),!1):(localStorage.setItem(this.options.refreshTokenLockLocalStorageKey,this.uniqueId),y.log("SET LOCK true uniqueId: ".concat(this.uniqueId)),!0)}},{key:"_clearRunningRefreshPromise",value:function(){this._clearRunningTimeout(),y.log("clear runningRefreshPromise"),this.runningRefreshPromise=null}},{key:"_clearRunningTimeout",value:function(){null!==this.refreshTimeoutId&&(y.log("CLEAR TIMEOUT: ",this.refreshTimeoutId),clearTimeout(this.refreshTimeoutId),this.refreshTimeoutId=null)}},{key:"_removeLock",value:function(e){return y.log("REMOVE LOCK uniqueId: ".concat(this.uniqueId,", force: ").concat(e)),e||localStorage.getItem(this.options.refreshTokenLockLocalStorageKey)===this.uniqueId?(localStorage.removeItem(this.options.refreshTokenLockLocalStorageKey),!0):(y.log("REMOVE LOCK FALSE"),!1)}},{key:"_isLocked",value:function(){var e=localStorage.getItem(this.options.refreshTokenLockLocalStorageKey);return y.log("IS LOCKED uniqueId: ".concat(e)),!!localStorage.getItem(this.options.refreshTokenLockLocalStorageKey)}},{key:"authenticate",value:function(){var e=s()(i.a.mark(function e(t){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,y.log("this.authenticate..."),!this._isTokenValid()){e.next=4;break}return e.abrupt("return");case 4:if(y.log("this.authenticate !this.isTokenValid()"),!this.refreshToken){e.next=18;break}return e.prev=6,e.next=9,this._refresh(t);case 9:y.log("self.authenticate after Refresh"),e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(6),y.log("authenticate refresh() error",e.t0),e.t0;case 16:e.next=19;break;case 18:throw new Error("You're not logged in");case 19:return e.prev=19,this._updateLoggedInStatus(),e.abrupt("return");case 23:case"end":return e.stop()}},e,this,[[0,,19,23],[6,12]])}));return function(t){return e.apply(this,arguments)}}()},{key:"login",value:function(e){var t=this,r={};return this.user=null,y.log("user set(login, clear): null"),this._runSyncedAuthenticationRequest(function(){return t._attachRequestQuarterback(t.axios.post(t._uri("login"),e,{credentials:!0,params:r})).then(function(e){return y.log("then after Login"),t._clearRunningRefreshPromise(),t._removeLock(),Promise.resolve(e)}).catch(function(e){return y.log("catch after Login"),t._clearRunningRefreshPromise(),t._removeLock(),Promise.reject(e)})})}},{key:"ssoLogin",value:function(e){var t=this,r={};return this.user=null,y.log("user set(ssoLogin, clear): null"),this._runSyncedAuthenticationRequest(function(){return t._attachRequestQuarterback(t.axios.post(t.options.ssoLoginUrl,e,{credentials:!0,params:r})).then(function(e){return y.log("then after ssoLogin"),t._clearRunningRefreshPromise(),t._removeLock(),Promise.resolve(e)}).catch(function(e){return y.log("catch after ssoLogin"),t._clearRunningRefreshPromise(),t._removeLock(),Promise.reject(e)})})}},{key:"loginOAuth",value:function(e){var t=this,n={};return this._runSyncedAuthenticationRequest(function(){return t._attachRequestQuarterback(t.axios.post(t._uri("oauthSso"),e,{credentials:!0,params:n})).then(function(e){return y.log("then after self.loginOAuth",e),t._clearRunningRefreshPromise(),t._removeLock(),Promise.resolve(e)}).catch(function(e){return y.log("catch after this.loginOAuth",e),t._clearRunningRefreshPromise(),t._removeLock(),Promise.resolve(r)})})}},{key:"loginAuth",value:function(e){var t=this,r={};return this._runSyncedAuthenticationRequest(function(){return t._attachRequestQuarterback(t.axios.post(t._uri("authSso"),e,{credentials:!0,params:r})).then(function(e){return y.log("then after this.loginAuth",e),t._clearRunningRefreshPromise(),t._removeLock(),Promise.resolve(e)}).catch(function(e){return y.log("catch after this.loginAuth"),t._clearRunningRefreshPromise(),t._removeLock(),Promise.reject(e)})})}},{key:"userInfo",value:function(){var e=this;return this.axios.get(this._uri("userinfo"),{credentials:!0,params:{}}).then(function(t){return e.user=Object.assign({},e.user,t.data),Promise.resolve(t)}).catch(function(e){return Promise.reject(e)})}},{key:"getServiceSsoUrl",value:function(e,t,r){return void 0===r&&(r={}),this.axios.post(this._uri("serviceSso"),{target_sso:e,target_url:t,params:r}).then(function(e){return e.data&&e.data.url?Promise.resolve(e.data.url):Promise.reject("No url in response")})}},{key:"goToServiceSSO",value:function(e,t,r){var n=this;return new Promise(function(o,i){n.getServiceSsoUrl(e,t,r).then(function(e){y.log("Redirect to target service: ".concat(e)),location.href=e,o(e)}).catch(function(e){i(e)})})}},{key:"getRedirectToServiceSSOUrl",value:function(e,t){void 0===t&&(t={}),t.target_url||(t.target_url=window.location.href);var r="target_sso="+e+"&target_url="+t.target_url;t.scope&&(r+="&scope="+t.scope),t.account_id&&(r+="&account_id="+t.account_id),t.td_installation_id&&(r+="&td_installation_id="+t.td_installation_id),t.td_user_id&&(r+="&td_user_id="+t.td_user_id);var n=this.frontendBaseUrl+"/"+encodeURI("?"+r);return y.log("getRedirectToServiceSSOUrl: ",n),n}},{key:"logout",value:function(){var e=s()(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return y.log("logout()"),e.prev=1,y.log("logout api call"),e.next=5,this.axios.get(this._uri("logout"),{timeout:5e3});case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),y.log("logout api call error",e.t0);case 10:return e.prev=10,y.log("logout clear tokens and all things..."),this._clearRunningRefreshPromise(),this._removeLock(!0),this.refreshToken=null,this.accessToken=null,this.clockSkew=null,this.user=null,y.log("user set(logout): null"),this.jwtPayload=null,this.expires=null,this.issuedAt=null,this.notBefore=null,this._updateLoggedInStatus(),e.finish(10);case 25:case"end":return e.stop()}},e,this,[[1,7,10,25]])}));return function(){return e.apply(this,arguments)}}()},{key:"switchAccount",value:function(e,t){var r={account_id:e};return t&&(r.scope=t),this._attachRequestQuarterback(this.axios.post(this._uri("switchAccount"),r))}},{key:"hasPermission",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".",r=!1;return this.user&&this.user.allow&&(r=function e(t,r){try{if(!t||!r)return!1;if(!Array.isArray(r))return t[0]in r?!(t.length>1)||e(t.slice(1),r[t[0]]):"*"in r;if(Array.isArray(r))return r.includes(t[0])?!(t.length>1)||e(t.slice(1),r[t[0]]):r.includes("*")}catch(e){return!1}}(e.split(t),this.user.allow)),r}},{key:"initialize",value:function(e){this._created(),"function"==typeof e&&e()}},{key:"expiresIn",get:function(){return!!this.expires&&1e3*this.expires-Date.now()}},{key:"idthrd",get:function(){return"idthrd:"+this.uniqueId}},{key:"frontendBaseUrl",get:function(){return this.options.baseUrl?this.options.baseUrl:this.options.url.substring(0,this.options.url.lastIndexOf("/identity"))}}],[{key:"publicMethods",get:function(){return["initialize","authenticate","login","ssoLogin","loginOAuth","loginAuth","userInfo","getServiceSsoUrl","goToServiceSSO","getRedirectToServiceSSOUrl","logout","switchAccount","hasPermission"]}},{key:"publicData",get:function(){return m}}]),e}();t.default=k}])},function(e,t,r){var n=r(13);e.exports=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),o.forEach(function(t){n(e,t,r[t])})}return e}},function(e,t){function r(e,t,r,n,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}e.exports=function(e){return function(){var t=this,n=arguments;return new Promise(function(o,i){var a=e.apply(t,n);function s(e){r(a,o,i,s,u,"next",e)}function u(e){r(a,o,i,s,u,"throw",e)}s(void 0)})}}},function(t,r){t.exports=e},function(e,t){e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){e.exports=r(1)},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n="ytica-js-logger:enabled",o={};function i(e,t){if(this.isBrowser&&!this.isEnabled)return!1;var r=this.options.formatter(Array.prototype.slice.call(t),this);this.options.logHandler&&this.enabledFor(e)&&this.options.logHandler(r,e),this.options.afterLog.call(this,r,e)}function a(e,t){if("undefined"!=typeof console){var r=console.log;t===o.ERROR&&console.error?r=console.error:t===o.WARN&&console.warn?r=console.warn:t===o.INFO&&console.info?r=console.info:t===o.DEBUG&&console.debug&&(r=console.debug),function(e,t){Function.prototype.apply.call(e,console,t)}(r,e)}}function s(e,t){return e.unshift("[".concat(t.options.name,"]")),e}o.DEBUG={value:0,name:"DEBUG"},o.INFO={value:1,name:"INFO"},o.WARN={value:2,name:"WARN"},o.ERROR={value:3,name:"ERROR"};var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r,i,u={level:o.INFO,logHandler:a,afterLog:function(){},suppress:[],formatter:s};this.options=Object.assign({},u,t),this.isBrowser&&(i=(r={enabled:!0}).enabled,r.logLevel,localStorage.getItem(n)||localStorage.setItem(n,i))}var t,u,c;return t=e,c=[{key:"DEBUG",get:function(){return o.DEBUG}},{key:"INFO",get:function(){return o.INFO}},{key:"WARN",get:function(){return o.WARN}},{key:"ERROR",get:function(){return o.ERROR}}],(u=[{key:"enabledFor",value:function(e){var t=this.localStorageDefaultLevel||this.options.level,r=e.value>=t.value,n=this.options.suppress.includes(e);return r&&!n}},{key:"debug",value:function(){i.call(this,o.DEBUG,arguments)}},{key:"info",value:function(){i.call(this,o.INFO,arguments)}},{key:"log",value:function(){i.call(this,o.INFO,arguments)}},{key:"warn",value:function(){i.call(this,o.WARN,arguments)}},{key:"error",value:function(){i.call(this,o.ERROR,arguments)}},{key:"isEnabled",get:function(){return JSON.parse(localStorage.getItem(n))}},{key:"localStorageDefaultLevel",get:function(){var e=localStorage.getItem("ytica-js-logger:logLevel");return o[e]}},{key:"isBrowser",get:function(){return"undefined"!=typeof window}}])&&r(t.prototype,u),c&&r(t,c),e}();e.exports=u}])},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}},function(e,r){e.exports=t},function(e,t){function r(){return e.exports=r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},r.apply(this,arguments)}e.exports=r},function(e,t){e.exports=n},function(e,t,r){var n=function(){return this||"object"==typeof self&&self}()||Function("return this")(),o=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,i=o&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,e.exports=r(12),o)n.regeneratorRuntime=i;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";var r,n=Object.prototype,o=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag",c="object"==typeof e,l=t.regeneratorRuntime;if(l)c&&(e.exports=l);else{(l=t.regeneratorRuntime=c?e.exports:{}).wrap=w;var f="suspendedStart",h="suspendedYield",d="executing",p="completed",g={},y={};y[a]=function(){return this};var v=Object.getPrototypeOf,m=v&&v(v(E([])));m&&m!==n&&o.call(m,a)&&(y=m);var k=b.prototype=R.prototype=Object.create(y);S.prototype=k.constructor=b,b.constructor=S,b[u]=S.displayName="GeneratorFunction",l.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===S||"GeneratorFunction"===(t.displayName||t.name))},l.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,u in e||(e[u]="GeneratorFunction")),e.prototype=Object.create(k),e},l.awrap=function(e){return{__await:e}},x(P.prototype),P.prototype[s]=function(){return this},l.AsyncIterator=P,l.async=function(e,t,r,n){var o=new P(w(e,t,r,n));return l.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},x(k),k[u]="Generator",k[a]=function(){return this},k.toString=function(){return"[object Generator]"},l.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},l.values=E,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=r)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,o){return s.type="throw",s.arg=e,t.next=n,o&&(t.method="next",t.arg=r),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var u=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=r),g}}}function w(e,t,r,n){var o=t&&t.prototype instanceof R?t:R,i=Object.create(o.prototype),a=new I(n||[]);return i._invoke=function(e,t,r){var n=f;return function(o,i){if(n===d)throw new Error("Generator is already running");if(n===p){if("throw"===o)throw i;return j()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=L(a,r);if(s){if(s===g)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===f)throw n=p,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=d;var u=_(e,t,r);if("normal"===u.type){if(n=r.done?p:h,u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=p,r.method="throw",r.arg=u.arg)}}}(e,r,a),i}function _(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function R(){}function S(){}function b(){}function x(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function P(e){var t;this._invoke=function(r,n){function i(){return new Promise(function(t,i){!function t(r,n,i,a){var s=_(e[r],e,n);if("throw"!==s.type){var u=s.arg,c=u.value;return c&&"object"==typeof c&&o.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,i,a)},function(e){t("throw",e,i,a)}):Promise.resolve(c).then(function(e){u.value=e,i(u)},function(e){return t("throw",e,i,a)})}a(s.arg)}(r,n,t,i)})}return t=t?t.then(i,i):i()}}function L(e,t){var n=e.iterator[t.method];if(n===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=r,L(e,t),"throw"===t.method))return g;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var o=_(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,g;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=r),t.delegate=null,g):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,g)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function E(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(o.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=r,t.done=!0,t};return i.next=i}}return{next:j}}function j(){return{value:r,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t){e.exports=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},function(e,t,r){"use strict";r.r(t);var n=r(0),o=r.n(n),i=r(3),a=r.n(i),s=r(2),u=r.n(s),c=r(6),l=r.n(c),f=r(7),h=r.n(f),d=r(1),p=r.n(d),g={propertyUpdated:"wfoIdentity:PROPERTY_UPDATED",methodsStored:"wfoIdentity:METHODS_STORED"};function y(e){return{type:g.propertyUpdated,payload:e}}var v,m=r(4),k=r(5),w=r.n(k),_=new w.a({name:"WFO Identity",level:w.a.ERROR}),R=function(){var e={};return Object.keys(p.a.publicData).map(function(t){return e[t]=p.a.publicData[t]}),p.a.publicMethods.map(function(t){return e[t]=void 0}),e.accountSid=void 0,e.axios=void 0,e.initialized=!1,e};function S(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R(),t=arguments.length>1?arguments[1]:void 0,r=!0;try{switch(t.type){case g.propertyUpdated:var n={};return n[t.payload.name]=t.payload.value,u()({},e,n);case g.methodsStored:return u()({},e,t.payload.publicMethods);default:return r=!1,e}}finally{r&&_.log("reducer process action: ".concat(t.type),t.payload)}}function b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};arguments.length>1&&arguments[1];return e}function x(e,t){console.log('addReducer name: "'.concat(e,'"')),v.reducers||(v.reducers={}),v.reducers[e]=t,Object.keys(v.reducers).length>2&&delete v.reducers.dummyReducer;var r=Object(m.combineReducers)(v.reducers);v.replaceReducer(r)}var P=function(){function e(t){var r,n=this;l()(this,e),this.options=t,this.clearLocalStorage(),this.$identity=new p.a(u()({},this.options,{onPropertyUpdated:this.onPropertyUpdated.bind(this),onLoggedInChanged:this.onLoggedInChanged.bind(this)})),this.store=this.initializeStore(),this.publicMethods={},p.a.publicMethods.forEach(function(e){return n.publicMethods[e]=n.$identity[e].bind(n.$identity)}),this.store.dispatch((r={publicMethods:this.publicMethods},{type:g.methodsStored,payload:r})),this.store.dispatch(y({name:"axios",value:this.options.axios}))}return h()(e,[{key:"initializeStore",value:function(){var e,t,r=(e="identity",t=S,console.log("initStore()"),(v=Object(m.createStore)(b)).reducers={dummyReducer:b},x(e,t),v);return r.subscribe(function(){window.console.log("[WFO] Store changed",r.getState())}),r}},{key:"clearLocalStorage",value:function(){window.localStorage.removeItem(this.options.accessTokenLocalStorageKey),window.localStorage.removeItem(this.refreshTokenLocalStorageKey)}},{key:"checkAuth",value:function(){var e=a()(o.a.mark(function e(){var t=this;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(_.log("Checking initialization..."),!1!==this.store.getState().identity.initialized){e.next=7;break}this.store.dispatch(y({name:"initialized",value:!0})),_.log("Not initialized. Starting init."),this.$identity.initialize(a()(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.loginFlex();case 2:return e.abrupt("return",!1);case 3:case"end":return e.stop()}},e,this)}))),e.next=9;break;case 7:return _.log("Already initialized. Skipping init."),e.abrupt("return",!0);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onPropertyUpdated",value:function(e){var t=e.name,r=e.value;this.store.dispatch(y({name:t,value:r}))}},{key:"onLoggedInChanged",value:function(){var e=a()(o.a.mark(function e(t,r){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==t||!1!==r||this.$identity.accessToken||this.$identity.refreshToken){e.next=4;break}return _.log("relogin attempt"),e.next=4,this.loginFlex();case 4:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}()},{key:"loginFlex",value:function(){var e=a()(o.a.mark(function e(){var t,r,n,i;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=JSON.parse(window.localStorage.getItem("TWILIO_FLEX_SSO")),r=t.identity,n=t.token,i=this.store.getState().identity.accountSid,r&&n&&i||_.error("Missing one of SSO params: identity, token, accountSid"),e.next=6,this.$identity.ssoLogin({identity:r,token:n,account_sid:i});case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),_.error("Could not authenticate: ".concat(e.t0.message||e.t0));case 11:case"end":return e.stop()}},e,this,[[0,8]])}));return function(){return e.apply(this,arguments)}}()}]),e}(),L=r(8),O=r.n(L),T=r(9),I=r.n(T),E=r(10),j=function(e){return e},U=function(e){var t=window.Twilio.Flex.Wfo.store;t||console.error("[WFO] Missing store instance.");var r=Object(E.connect)(j)(e);return function(e){return React.createElement(r,I()({},e,{store:t}))}};function A(){var e={axios:O.a,url:"https://identity.ytica.com/identity",baseUrl:"https://identity.ytica.com",accessTokenLocalStorageKey:"ytica-identity-client-vue:accessToken",refreshTokenLocalStorageKey:"ytica-identity-client-vue:refreshToken"},t={};return t.Identity=new P(e),t.withWfo=U,t.store=t.Identity.store,t.addReducer=x,t}r.d(t,"Identity",function(){return P}),r.d(t,"initWfoIdentity",function(){return A}),r.d(t,"withWfo",function(){return U}),r.d(t,"addReducer",function(){return x})}])});