# Changelog
All notable changes to this project will be documented in this file.

## [Unreleased]

## 1.6.0

### Added
- Add support for a "predefinedMessage" in the MessagingCanvas to display an initial message in the ChatWidget.
- Add `agentAvailableColor`, `agentBusyColor`, `agentUnavailableColor`, `agentOfflineColor` colors to theme.

### Changed
- Extend TaskChannelDefinition with a `componentProps` object to allow taskChannel-specific component props modifications.
- Conference State support to monitor participants and their statuses via Sync Insights. Surfaced via Task Context as `conference` property.
- Call monitoring now also works when forwarding the calls to phone number
- New designs for task call view and task list item. Also updated the incoming transfer views

### Fixed
- Get 'Offline' activity sid from serviceConfiguration.taskrouter_offline_activity_sid

## 1.5.0

### Added
- WFO identity client integrated and exposed through `Twilio.Flex.Wfo.Identity`
- New 'untrustedDomain' exception on login attempts from non-whitelisted domains
- TaskSid and ReservationSid in task info panel

### Changed
- Flex requires `<meta name="referrer" content="no-referrer">` element to be present in `<head>` section of HTML. If such element does not exists then Flex will issue additional browser redirect in login flow after returning from IdP (and token is present in the URL).
- Deprecated `Reserved` and `Assigned` keys in `TaskStatusBasedTypeBase` for task channel definitions. Use new `Accepted` key for reservation accepted state.
- Hide main action button on login when a Validation error (sso, untrusted domain) is thrown.
- On logout, try to detect 'Offline' activity by "sid" (serviceConfiguration.attributes.taskrouter_offline_activity_sid) and, if that's not provided, fallback to the name.

### Fixed
- Use `Pending` task based status key from task channel definition if both `Pending` and `Reserved` were defined for TaskStatusBasedTypeBase.
- Agent status in supervisor agent panel now correctly updates, even with a filtered-out agent.

## 1.4.1
### Fixed
- Teams view "Active agents" filter to dynamically generate and use the query to include agents in all `available` activities from TaskRouter.

## 1.4.0
### Changed
- Call Tasks will now be accepted with `endConferenceOnExit` set to `true`, so when agent ends the call the call will be ended for the customer as well. There is no reason anymore to
override the `acceptTask` action to achieve this.
- Removed the `disabledTransfers` config option as it is obsolete due to the change above.
- Agent activity duration will now be shown in the teams view and header User card.
- Updated logout view with new design.
- Enabled plugin service by default.

## 1.3.0
### Added
- New FlexEvent `FlexEvents.pluginsLoaded` that fires after all plugins have finished loading.
- `MonitorTask` action payload got a new param `extraParams` that is the equally named TR SDK param for `Reservation.monitor` call. It is optional and UI does not set it, but developer can alter it via programmability if need be.
- Exposed common dependencies like `React`, `ReactDOM`, `Redux` and `ReactRedux` to window object for plugins to depend on.
- Error notification when browser is unable to access microphone.
- New option `isolate` for `router` configuration section: whenever set to true, Flex will ignore any navigation action (including URL change) except for internal.
- Default route may now be changed via `componentProps` by setting `defaultLocation` property for `ViewCollection`.
- Flex navigation action type is exposed through `FLEX_LOCATION_CHANGE` constant. It can be used to listen to Flex navigation actions or do dispatch Flex-specific navigation actions.
- `disableBrowserVoice` option for configuration. When specified Twilio Client SDK (for Browser voice capability) will not be initialized. Attempting to accept a task that is voice and with worker's `contact_uri` not pointing to a phone number, the attempt is blocked and warning is shown.
- Character limit information added to chat channel definitions.
- Registered a `beforeSendMessage` action to check if the message exceeds the limit and handle it accordingly.
- SSO login in pop-up window support added. ```config.sso.loginPopup = true``` can be set to enable it. To gracefully handle blocked popups, new `LoginFormView` React component or `provideLoginInfo` or `tryLogin` Twilio.Flex API function can be used to launch it. Additionally pop-up window features for `window.open()` function can be set in `config.sso.loginPopupFeatures` configuration variable as string.
- New API functions to run or log user in to Flex using `Twilio.Flex` interface:
```
    /**
    * Runs Flex with default setup.
    * It will show loader and prompts for login information
    * if it is not provided in configuration object.
    *
    * @param [config] configuration object
    * @param [nodeOrSelector] DOM node or selector string where to render Flex
    * @returns {Promise<void>}
    */
    export function runDefault(config: Config = {}, nodeOrSelector: string | Element = "body"): Promise<void>;

    /**
    * Tries to log user in to Flex.
    * Can redirect the current browser window to the IdP URL or
    * open a new window to navigate to IdP URL if config.loginPopup is set.
    *
    * @param [config] SSO configuration object
    * @return {Promise<boolean>} true if there is valid token and user can be logged in.
    */
    function tryLogin(config: SSOConfig = {}): Promise<boolean>;

    /**
    * Helper function to provide additional account and user info if it is not set.
    * Updates the provided config object.
    *
    * Renders a LoginFormView component if accountSid is not provided or there are problems with signing user in.
    *
    * @param [config] configuration object
    * @param [nodeOrSelector] DOM node or selector string where to render the component
    * @returns {Promise<void>} if resolved, then Flex instance can be created with
    *      provided config object.
    */
    function provideLoginInfo(config: Config = {}, nodeOrSelector: string | Element = "body"): Promise<void>;
```
- New `LoginFormView` React component to be used to provide account / user info with the following props:
```
interface LoginFormViewProps {
    onSuccess: (determinedConfig: Config) => any;
    userConfig: Config;
}
```
- New strings for `LoginFormView` component:
```
    LoginContinue: "Continue anyway",
    LoginLaunch: "Launch",
    LoginTitle: "Twilio Flex",
    LoginErrorDomain: "Oops! Your runtime domain is incorrect.",
    LoginErrorDomainDetails: "Find your runtime domain " +
        "<a href='https://www.twilio.com/console/runtime/overview'>here</a>",
    LoginErrorSso: "Hmm, Single Sign-On has not been configured.",
    LoginErrorSsoDetails: "Find out how to configure Single Sign-On " +
        "<a href='https://www.twilio.com/console/flex/users/single-sign-on'>here</a>",
    LoginErrorPopupBlocked: "Sorry, pop-ups are blocked.",
    LoginErrorPopupBlockedDetails: "Find out how to enable pop-ups in your browser",
    LoginErrorGeneric: "Oops! Well, that didnâ€™t work :( Please double check your configuration.",
    LoginIsAdmin: "Flex Admin?",
    LoginWithTwilio: "Login with Twilio.",
```

### Changed
- `View` now has multiple route path support. By default `name` prop is taken as string to be added to the path of the specified `View`.
One can add alternative routes with `route` prop. Example:

    ```<View key="teams" name="teams" route={{ path: "/supervisor" }}>  // both http:/domain/teams and http://domain/supervisor will work```

    ```<View key="teams" name="teams" route={{ path: ["/supervisor", "something"] }}>  // both http:/domain/teams and http://domain/supervisor and http://domain/something will work```
- `ViewCollection` was not using DynamicComponent properly so all manipulations of it other than `add` via programmability did not work.
= Global mute button will be disabled if there are no active calls.

###Fixed
- Global mute button indicated muted state even after the call had ended.

## 1.2.0
### Fixed
- Use react and react-dom version 16.5.2

### Changed
- `baseNames` theme names changed

| Deprecated name | New Theme name |
| --------------- | -------------- |
| DarkTheme       | GreyDark       |
| MediumTheme     | GreyLight      |
| BlueMediumTheme | FlexLight      |
| BlueDarkTheme   | FlexDark       |


- Switch from `icon` to `label` in `Tab` label components in agent `TaskCanvasTabs` and supervisor `TaskCanvas`

### Added
- New localization strings for TaskTabAgentIncomingLabel, TaskTabAgentCallLabel, TaskTabAgentChatLabel,
TaskTabAgentInfoLabel, TaskTabSupervisorInfoLabel and TaskTabSupervisorOverviewLabel

```
export interface Strings<T = string> extends FrameStrings<T> {
    ...
    TaskTabAgentIncomingLabel?: T;
    TaskTabAgentCallLabel?: T;
    TaskTabAgentChatLabel?: T;
    TaskTabAgentInfoLabel?: T;
    TaskTabSupervisorInfoLabel?: T;
    TaskTabSupervisorOverviewLabel?: T;
}
```

- `Views` of `ViewCollection` got a new prop `mountRule`. If specified, `keepMounted` prop value is ignored. Definition of the prop is as follows:

```
export enum ViewMountRule {
    Always = "Always",  // View is mounted from the start of the application and never unmounted
    WhenActive = "WhenActive", // Views is mounted when activated and unmounted when deactivated
    WhenHasBeenActive = "WhenHasBeenActive" // View is mounted when first activated and never umounted
}
```

## 1.1.0

### Fixed
- TypeScript definitions of the package were referencing some missing files

### Added

- Ability to transfer calls to a Queue from Directory Component (previously only workers were present there)
- Action `TransferTask` was introduced with following payload:
```
{
    sid?: string; // sid of the ITask to transfer
    task?: ITask; // ITask object representing the Reservation being transferred
    targetSid: string; // sid of the Worker or Queue where the task should be transferred to
    options?: Object // options passed over to TaskRouter SDK transfer call. Refer to TaskRouter SDK documentation on Task.transfer option values.
}
```
As with all other Task specific actions, if calling it, either `task` or `sid` must be specified, the other is autofilled then accordingly. When tapping into the action either with events or task replacement, both will be filled at execution time.

## 1.0.2

### Fixed

- Regular agents were not able to open up directory button for transfers
- MainHeader now again accepts changing logoUrl default property

## 1.0.1
### Fixed

- CRMContainer and MessagingCanvas did not pass props down to their custom children
- Issues with broken UI when using custom store
